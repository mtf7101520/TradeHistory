<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高频交易记录分析系统</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-family: 'Arial', sans-serif; }
        .main-container { min-height: 100vh; padding: 20px; }
        .header { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px; margin-bottom: 20px; backdrop-filter: blur(10px); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .chart-container { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px; margin-bottom: 20px; backdrop-filter: blur(10px); }
        .data-table { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px; backdrop-filter: blur(10px); margin-bottom: 20px; }
        .ranking-container { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px; margin-bottom: 20px; backdrop-filter: blur(10px); }
        .mistake-book { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px; margin-bottom: 20px; backdrop-filter: blur(10px); }
        .add-record-btn { position: fixed; bottom: 30px; right: 30px; z-index: 1000; }
        .profit { color: #67C23A; font-weight: bold; }
        .loss { color: #F56C6C; font-weight: bold; }
        .trade-type-buy { background: #F56C6C; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .trade-type-sell { background: #67C23A; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .trade-type-add { background: #409EFF; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .ranking-item { display: flex; align-items: center; padding: 10px; margin-bottom: 8px; border-radius: 8px; background: #f8f9fa; }
        .ranking-number { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; }
        .ranking-1 { background: #FFD700; color: #fff; }
        .ranking-2 { background: #C0C0C0; color: #fff; }
        .ranking-3 { background: #CD7F32; color: #fff; }
        .ranking-other { background: #e9ecef; color: #666; }
        .mistake-item { background: #fff2f0; border: 1px solid #ffccc7; border-radius: 8px; padding: 15px; margin-bottom: 10px; }
        .mistake-header { display: flex; justify-content: between; align-items: center; margin-bottom: 10px; }
        .mistake-stock { font-weight: bold; color: #F56C6C; }
        .mistake-loss { color: #F56C6C; font-size: 14px; }
        .mistake-reason { color: #666; font-size: 14px; line-height: 1.5; }
        .tab-content { margin-top: 20px; }
    </style>
</head>
<body>
    <div id="app">
        <div class="main-container">
            <div class="header">
                <h1 style="text-align: center; color: #333; font-size: 28px;">高频交易记录分析系统</h1>
                <p style="text-align: center; color: #666; margin-top: 10px;">智能分析交易数据，优化投资策略</p>
            </div>

            <!-- 统计卡片 -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>总交易次数</h3>
                    <div style="font-size: 32px; font-weight: bold; margin-top: 10px;">{{ totalTrades }}</div>
                </div>
                <div class="stat-card">
                    <h3>总盈亏</h3>
                    <div style="font-size: 32px; font-weight: bold; margin-top: 10px;" :class="totalProfit >= 0 ? 'profit' : 'loss'">
                        {{ formatCurrency(totalProfit) }}
                    </div>
                </div>
                <div class="stat-card">
                    <h3>胜率</h3>
                    <div style="font-size: 32px; font-weight: bold; margin-top: 10px;">{{ winRate }}%</div>
                </div>
                <div class="stat-card">
                    <h3>平均每笔收益</h3>
                    <div style="font-size: 32px; font-weight: bold; margin-top: 10px;" :class="avgProfit >= 0 ? 'profit' : 'loss'">
                        {{ formatCurrency(avgProfit) }}
                    </div>
                </div>
            </div>

            <!-- 图表区域 -->
            <div class="chart-container">
                <h3 style="margin-bottom: 20px;">盈亏趋势图</h3>
                <div id="profitChart" style="height: 400px;"></div>
            </div>

            <!-- 标签页导航 -->
            <div class="data-table">
                <el-tabs v-model="activeTab" type="card">
                    <el-tab-pane label="交易记录" name="records">
                        <div style="margin-bottom: 20px;">
                            <el-button type="primary" @click="dialogVisible = true">
                                <i class="el-icon-plus"></i> 添加交易记录
                            </el-button>
                            <el-button @click="exportData" style="margin-left: 10px;">导出数据</el-button>
                        </div>
                        
                        <el-table :data="paginatedTrades" stripe style="width: 100%">
                            <el-table-column prop="date" label="日期" width="120"></el-table-column>
                            <el-table-column prop="stock" label="股票代码" width="100"></el-table-column>
                            <el-table-column prop="stockName" label="股票名称" width="120"></el-table-column>
                            <el-table-column label="交易类型" width="100">
                                <template #default="scope">
                                    <span :class="getTradeTypeClass(scope.row.type)">
                                        {{ getTradeTypeText(scope.row.type) }}
                                    </span>
                                </template>
                            </el-table-column>
                            <el-table-column prop="quantity" label="数量" width="100"></el-table-column>
                            <el-table-column prop="price" label="价格" width="100">
                                <template #default="scope">
                                    {{ formatCurrency(scope.row.price) }}
                                </template>
                            </el-table-column>
                            <el-table-column prop="profit" label="盈亏" width="120">
                                <template #default="scope">
                                    <span :class="scope.row.profit >= 0 ? 'profit' : 'loss'">
                                        {{ formatCurrency(scope.row.profit) }}
                                    </span>
                                </template>
                            </el-table-column>
                            <el-table-column prop="notes" label="备注" min-width="150"></el-table-column>
                            <el-table-column label="操作" width="120">
                                <template #default="scope">
                                    <el-button size="mini" @click="editTrade(scope.row)">编辑</el-button>
                                    <el-button size="mini" type="danger" @click="deleteTrade(scope.$index)">删除</el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                        
                        <el-pagination
                            @current-change="handleCurrentChange"
                            :current-page="currentPage"
                            :page-size="pageSize"
                            layout="total, prev, pager, next"
                            :total="trades.length"
                            style="margin-top: 20px; text-align: center;">
                        </el-pagination>
                    </el-tab-pane>

                    <el-tab-pane label="收益排行榜" name="ranking">
                        <div class="ranking-container">
                            <el-row :gutter="20">
                                <el-col :span="12">
                                    <h3 style="margin-bottom: 20px; color: #67C23A;">📈 盈利排行榜</h3>
                                    <div v-for="(item, index) in profitRanking" :key="index" class="ranking-item">
                                        <div :class="getRankingClass(index + 1)">{{ index + 1 }}</div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: bold;">{{ item.stockName || item.stock }}</div>
                                            <div style="font-size: 12px; color: #666;">{{ item.stock }}</div>
                                        </div>
                                        <div class="profit" style="font-size: 16px; font-weight: bold;">
                                            {{ formatCurrency(item.profit) }}
                                        </div>
                                    </div>
                                </el-col>
                                <el-col :span="12">
                                    <h3 style="margin-bottom: 20px; color: #F56C6C;">📉 亏损排行榜</h3>
                                    <div v-for="(item, index) in lossRanking" :key="index" class="ranking-item">
                                        <div :class="getRankingClass(index + 1)">{{ index + 1 }}</div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: bold;">{{ item.stockName || item.stock }}</div>
                                            <div style="font-size: 12px; color: #666;">{{ item.stock }}</div>
                                        </div>
                                        <div class="loss" style="font-size: 16px; font-weight: bold;">
                                            {{ formatCurrency(item.profit) }}
                                        </div>
                                    </div>
                                </el-col>
                            </el-row>
                        </div>
                    </el-tab-pane>

                    <el-tab-pane label="失败交易错题集" name="mistakes">
                        <div class="mistake-book">
                            <h3 style="margin-bottom: 20px; color: #F56C6C;">📚 失败交易分析与总结</h3>
                            <el-alert
                                title="错题集说明"
                                description="记录每次失败交易的原因，帮助总结经验教训，避免重复犯错"
                                type="info"
                                :closable="false"
                                style="margin-bottom: 20px;">
                            </el-alert>
                            
                            <div v-if="failedTrades.length === 0" style="text-align: center; color: #999; padding: 40px;">
                                🎉 恭喜！暂无失败交易记录
                            </div>
                            
                            <div v-for="(trade, index) in failedTrades" :key="index" class="mistake-item">
                                <div class="mistake-header">
                                    <div>
                                        <span class="mistake-stock">{{ trade.stockName || trade.stock }}</span>
                                        <span style="margin-left: 10px; color: #999; font-size: 12px;">{{ trade.date }}</span>
                                    </div>
                                    <div class="mistake-loss">亏损: {{ formatCurrency(Math.abs(trade.profit)) }}</div>
                                </div>
                                <div style="margin-bottom: 8px; font-size: 14px; color: #666;">
                                    <strong>交易详情:</strong> {{ getTradeTypeText(trade.type) }} {{ trade.quantity }}股 @ {{ formatCurrency(trade.price) }}
                                </div>
                                <div class="mistake-reason">
                                    <strong>失败原因:</strong> {{ trade.failureReason || '未填写失败原因' }}
                                </div>
                                <div v-if="trade.notes" style="margin-top: 8px; font-size: 12px; color: #888;">
                                    <strong>备注:</strong> {{ trade.notes }}
                                </div>
                            </div>
                            
                            <!-- 失败原因统计 -->
                            <div v-if="failedTrades.length > 0" style="margin-top: 30px;">
                                <h4 style="margin-bottom: 15px;">失败原因统计</h4>
                                <div id="failureReasonChart" style="height: 300px;"></div>
                            </div>
                        </div>
                    </el-tab-pane>
                </el-tabs>
            </div>
        </div>

        <!-- 添加/编辑交易记录对话框 -->
        <el-dialog :title="isEditing ? '编辑交易记录' : '添加交易记录'" v-model="dialogVisible" width="500px">
            <el-form :model="newTrade" label-width="100px">
                <el-form-item label="日期">
                    <el-date-picker v-model="newTrade.date" type="date" format="YYYY-MM-DD" value-format="YYYY-MM-DD" style="width: 100%;"></el-date-picker>
                </el-form-item>
                <el-form-item label="股票代码">
                    <el-input v-model="newTrade.stock" placeholder="请输入股票代码"></el-input>
                </el-form-item>
                <el-form-item label="股票名称">
                    <el-input v-model="newTrade.stockName" placeholder="请输入股票名称"></el-input>
                </el-form-item>
                <el-form-item label="交易类型">
                    <el-select v-model="newTrade.type" style="width: 100%;">
                        <el-option label="买入" value="buy"></el-option>
                        <el-option label="卖出" value="sell"></el-option>
                        <el-option label="加仓" value="add"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="数量">
                    <el-input-number v-model="newTrade.quantity" :min="1" style="width: 100%;"></el-input-number>
                </el-form-item>
                <el-form-item label="价格">
                    <el-input-number v-model="newTrade.price" :precision="2" :min="0" style="width: 100%;"></el-input-number>
                </el-form-item>
                <el-form-item label="盈亏">
                    <el-input-number v-model="newTrade.profit" :precision="2" style="width: 100%;"></el-input-number>
                </el-form-item>
                <el-form-item label="失败原因" v-if="newTrade.profit < 0">
                    <el-input v-model="newTrade.failureReason" type="textarea" :rows="3" placeholder="请分析失败原因，便于后续总结"></el-input>
                </el-form-item>
                <el-form-item label="备注">
                    <el-input v-model="newTrade.notes" type="textarea" :rows="3"></el-input>
                </el-form-item>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="dialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="saveTrade">保存</el-button>
                </span>
            </template>
        </el-dialog>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElButton, ElTable, ElTableColumn, ElDialog, ElForm, ElFormItem, ElInput, ElInputNumber, ElSelect, ElOption, ElDatePicker, ElPagination, ElTabs, ElTabPane, ElRow, ElCol, ElAlert } = ElementPlus;

        createApp({
            components: {
                ElButton, ElTable, ElTableColumn, ElDialog, ElForm, ElFormItem, ElInput, ElInputNumber, ElSelect, ElOption, ElDatePicker, ElPagination, ElTabs, ElTabPane, ElRow, ElCol, ElAlert
            },
            data() {
                return {
                    activeTab: 'records',
                    dialogVisible: false,
                    isEditing: false,
                    editingIndex: -1,
                    currentPage: 1,
                    pageSize: 10,
                    trades: [
                        { date: '2024-01-15', stock: '000001', stockName: '平安银行', type: 'buy', quantity: 100, price: 15.20, profit: 150.00, notes: '技术面良好', failureReason: '' },
                        { date: '2024-01-16', stock: '000002', stockName: '万科A', type: 'sell', quantity: 200, price: 18.50, profit: -320.00, notes: '止损出局', failureReason: '未及时关注政策风险，房地产板块整体下跌' },
                        { date: '2024-01-17', stock: '600519', stockName: '贵州茅台', type: 'add', quantity: 10, price: 1680.00, profit: 500.00, notes: '长期持有', failureReason: '' },
                        { date: '2024-01-18', stock: '600036', stockName: '招商银行', type: 'buy', quantity: 300, price: 42.10, profit: -180.00, notes: '银行股调整', failureReason: '忽略了银行业净息差收窄的影响，过早入场' }
                    ],
                    newTrade: {
                        date: new Date().toISOString().split('T')[0],
                        stock: '',
                        stockName: '',
                        type: 'buy',
                        quantity: 100,
                        price: 0,
                        profit: 0,
                        notes: '',
                        failureReason: ''
                    }
                }
            },
            computed: {
                totalTrades() {
                    return this.trades.length;
                },
                totalProfit() {
                    return this.trades.reduce((sum, trade) => sum + trade.profit, 0);
                },
                winRate() {
                    const winTrades = this.trades.filter(trade => trade.profit > 0).length;
                    return this.totalTrades > 0 ? Math.round((winTrades / this.totalTrades) * 100) : 0;
                },
                avgProfit() {
                    return this.totalTrades > 0 ? this.totalProfit / this.totalTrades : 0;
                },
                paginatedTrades() {
                    const start = (this.currentPage - 1) * this.pageSize;
                    return this.trades.slice(start, start + this.pageSize);
                },
                profitRanking() {
                    const stockProfits = {};
                    this.trades.forEach(trade => {
                        const key = trade.stock;
                        if (!stockProfits[key]) {
                            stockProfits[key] = {
                                stock: trade.stock,
                                stockName: trade.stockName,
                                profit: 0
                            };
                        }
                        stockProfits[key].profit += trade.profit;
                    });
                    return Object.values(stockProfits)
                        .filter(item => item.profit > 0)
                        .sort((a, b) => b.profit - a.profit)
                        .slice(0, 10);
                },
                lossRanking() {
                    const stockProfits = {};
                    this.trades.forEach(trade => {
                        const key = trade.stock;
                        if (!stockProfits[key]) {
                            stockProfits[key] = {
                                stock: trade.stock,
                                stockName: trade.stockName,
                                profit: 0
                            };
                        }
                        stockProfits[key].profit += trade.profit;
                    });
                    return Object.values(stockProfits)
                        .filter(item => item.profit < 0)
                        .sort((a, b) => a.profit - b.profit)
                        .slice(0, 10);
                },
                failedTrades() {
                    return this.trades
                        .filter(trade => trade.profit < 0)
                        .sort((a, b) => new Date(b.date) - new Date(a.date));
                },
                failureReasons() {
                    const reasons = {};
                    this.failedTrades.forEach(trade => {
                        const reason = trade.failureReason || '未分析';
                        if (!reasons[reason]) {
                            reasons[reason] = { count: 0, loss: 0 };
                        }
                        reasons[reason].count++;
                        reasons[reason].loss += Math.abs(trade.profit);
                    });
                    return reasons;
                }
            },
            mounted() {
                this.$nextTick(() => {
                    this.initCharts();
                });
            },
            watch: {
                activeTab(newTab) {
                    this.$nextTick(() => {
                        if (newTab === 'mistakes' && this.failedTrades.length > 0) {
                            this.initFailureReasonChart();
                        }
                    });
                }
            },
            methods: {
                initCharts() {
                    // 盈亏趋势图
                    const chartDom = document.getElementById('profitChart');
                    const myChart = echarts.init(chartDom);
                    
                    let cumulativeProfit = 0;
                    const data = this.trades.map((trade, index) => {
                        cumulativeProfit += trade.profit;
                        return {
                            date: trade.date,
                            profit: cumulativeProfit,
                            dailyProfit: trade.profit
                        };
                    });

                    const option = {
                        tooltip: {
                            trigger: 'axis',
                            formatter: function(params) {
                                const point = params[0];
                                const trade = data[point.dataIndex];
                                return `日期: ${point.name}<br/>
                                       累计盈亏: ${trade.profit.toFixed(2)}元<br/>
                                       当日盈亏: ${trade.dailyProfit.toFixed(2)}元`;
                            }
                        },
                        grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },
                        xAxis: { type: 'category', data: data.map(d => d.date) },
                        yAxis: { type: 'value', name: '盈亏(元)' },
                        series: [{
                            name: '累计盈亏',
                            type: 'line',
                            data: data.map(d => d.profit),
                            smooth: true,
                            itemStyle: { color: '#5470c6' },
                            areaStyle: { 
                                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                    { offset: 0, color: 'rgba(84, 112, 198, 0.3)' },
                                    { offset: 1, color: 'rgba(84, 112, 198, 0.1)' }
                                ])
                            }
                        }]
                    };
                    
                    myChart.setOption(option);
                },
                initFailureReasonChart() {
                    const chartDom = document.getElementById('failureReasonChart');
                    if (!chartDom) return;
                    
                    const myChart = echarts.init(chartDom);
                    const reasons = this.failureReasons;
                    
                    const data = Object.keys(reasons).map(key => ({
                        name: key,
                        value: reasons[key].count,
                        loss: reasons[key].loss
                    }));

                    const option = {
                        tooltip: {
                            trigger: 'item',
                            formatter: '{b}: {c}次<br/>总亏损: {d}元'
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'left'
                        },
                        series: [{
                            name: '失败原因',
                            type: 'pie',
                            radius: '50%',
                            data: data,
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }]
                    };
                    
                    myChart.setOption(option);
                },
                formatCurrency(value) {
                    return `¥${value.toFixed(2)}`;
                },
                getTradeTypeText(type) {
                    const types = { buy: '买入', sell: '卖出', add: '加仓' };
                    return types[type] || type;
                },
                getTradeTypeClass(type) {
                    return `trade-type-${type}`;
                },
                getRankingClass(rank) {
                    if (rank === 1) return 'ranking-number ranking-1';
                    if (rank === 2) return 'ranking-number ranking-2';
                    if (rank === 3) return 'ranking-number ranking-3';
                    return 'ranking-number ranking-other';
                },
                handleCurrentChange(page) {
                    this.currentPage = page;
                },
                saveTrade() {
                    if (this.isEditing) {
                        this.$set(this.trades, this.editingIndex, {...this.newTrade});
                    } else {
                        this.trades.push({...this.newTrade});
                    }
                    this.dialogVisible = false;
                    this.resetForm();
                    this.$nextTick(() => {
                        this.initCharts();
                    });
                },
                editTrade(trade) {
                    this.newTrade = {...trade};
                    this.isEditing = true;
                    this.editingIndex = this.trades.indexOf(trade);
                    this.dialogVisible = true;
                },
                deleteTrade(index) {
                    const realIndex = (this.currentPage - 1) * this.pageSize + index;
                    this.trades.splice(realIndex, 1);
                    this.$nextTick(() => {
                        this.initCharts();
                    });
                },
                resetForm() {
                    this.newTrade = {
                        date: new Date().toISOString().split('T')[0],
                        stock: '',
                        stockName: '',
                        type: 'buy',
                        quantity: 100,
                        price: 0,
                        profit: 0,
                        notes: '',
                        failureReason: ''
                    };
                    this.isEditing = false;
                    this.editingIndex = -1;
                },
                exportData() {
                    const dataStr = JSON.stringify(this.trades, null, 2);
                    const blob = new Blob([dataStr], {type: 'application/json'});
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `trading_records_${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>